%------------------------------------------------------------------------
% Chapter:  Introduction
%------------------------------------------------------------------------

\chapter{Introduction \label{intro}}
\section{What is DISCUS\_SUITE ?}

The \Suite is a combination of the components of the DISCUS program 
suite. It includes the sections 
\href{./discus\_man.pdf}\discus, 
\href{./diffev\_man.pdf}\diffev, 
\href{./refine\_man.pdf}\refine, and
\href{./kuplot\_man.pdf}\Kuplot under a common  command language. 
The command language is documented in the manual 
\href{./package\_man.pdf}{package\_man}.\\
In this combination, the 
\Suite allows you to seamlessly switch between the individual
sections. Its main advantage lies in the field of massive parallel 
computing. As the \Suite includes the full functionality of 
\diffev, the \Suite allows you to perform parallel refinements.
In contrast to a stand alone \diffev, the \Suite does have to
perform nearly no I/O during the refinement.

See the \Diffev and \Refine manuals for full details of the 
refinement process.

As of Versions 6.02.00 and later, the \Suite is compiled with
OpenMP, a standard for parallel processing. This will accelerate
the calculations: powder, fourier and mmc within \discus. See the
command language documentation for the commands {\tt set} and
{\tt show} to control the number of parallel threads that will be 
executed.

%------------------------------------------------------------------------

\section{Getting started \label{intro-get}}

\subsection{Windows}

Once the \Suite has been installed you should see an icon called
{\tt Discus\_SUITE\_WSL\ }
on your personal desktop. Double click the icon to start
the program of your choice.

At program start, \Suite sets its starting folder to\\
\begin{MacVerbatim}
   C:\Users\your_name
\end{MacVerbatim}
where {\tt your\_name} will be your user name. The string {\tt Users}
may be slightly different depending on the language settings.
To work with data and macros that are stored in a separate folder,
you need to change to this folder.

Within the \Suite program window, type the command {\tt cd } including a
blank space after the {\tt cd}. At this point do not hit the enter key.
Open the desired folder with the Windows-Explorer. Left click on the
small folder symbol in the top line that indicates the path to your
folder. This should highlight the full path to the folder.

Select the highlighted path to the folder
with CTRL-c. Activate the \Suite window and press the
middle button on the mouse. This should place the full path into the
program window. As of version 5.25 you can also press CTRL-SHIFT-v to
insert the directory path. Incidentally this holds for any string that had
been copied into the clipboard with CTRL-c. 

Once you activate the window and hit the ENTER key the program will
work in this folder.

Roughly every week the program will automatically update the 
Windows-Subsystem-Linux (Ubuntu) on which the discus-suite runs. 
This will be performed upon the exit from the suite and should not take long.

To install future updates simply type the discus\_suite command {\tt update}.

As the \Suite runs on top of the Windows-Subsystem-Linux, a Linux distribution,
access to the removable disks is slightly different than for a original Windows 
program. Unfortunately, to date the Windows-Subsystem-Linux does not perform 
an automatic mounting of removable drives such as a USB drive. The suite will
do such a mount process if you use the command {\tt cd F:} to access a drive 
{\tt F:}. As the \Suite cannot know if you do not need this drive any longer, 
the drive is not automatically dismounted once you change back to the {\tt C:}
drive or even when you exit the program. Other instances of the \Suite might still
need the drive. Thus it is left to you to dismount a drive with the 
{\tt umount F:} command once your are finished.

\subsection{Linux}


After the program {\it DISCUS\_SUITE} has been installed properly and the
environment variables are set, the program can be started by typing
'discus\_suite' at the operating systems prompt.

To install future updates simply type the discus\_suite command {\tt update}.

\subsection{MAC}

After the program {\it DISCUS\_SUITE} has been installed properly and the
environment variables are set, the program can be started by first 
starting a terminal window and typing
'discus\_suite' at the operating systems prompt.

To install future updates simply type the discus\_suite command {\tt update}.

\subsection{General introduction}

The program uses a command language to interact with the user.  The
command {\tt exit} terminates the program and returns control to the
shell.  All commands of \Suite consist of a command verb,
optionally followed by one or more parameters.  All parameters must
be separated from one another by a comma ",".  There is no
predefined need for any specific sequence of commands.  \Suite     
is case sensitive, all commands and alphabetic parameters MUST be
typed in lower case letters.  If \Suite has been compiled
using the {\tt -DREADLINE} option (see installation files) basic
line editing and recall of commands is possible.  For more
information refer to the reference manual or check the online help
using ({\tt help command input}).  Names of input or output files
are to be typed as they will be expected by the shell.  If necessary
include a path to the file.  All commands may be abbreviated to the
shortest unique possibility. At least a single space is needed
between the command verb and the first parameter.  No comma is to
precede the first parameter. A line can be marked as comment by
inserting a "{\tt \#}" as first character in the line.\par

The symbols used throughout this manual to describe commands,
command parameters, or explicit text used by the program \Suite     
are listed in Table \ref{sym-tab}. There are several sources
of information, first \Suite  has a build in online help, which
can be accessed by entering the command {\tt help} or if help for a
particular command $<$cmd$>$ is wanted by {\tt help $<$cmd$>$}. This
manual describes background and principle functions of \Suite
and should give some insight in the ways to use this program. \par

\subsection{Overview}

\begin{table}[!tbh]
\centering
\begin{tabularx}{\textwidth}{|p{30mm}|X|}
  \hline
  {\bf Symbol} & {\bf Description} \\
  \hline\hline
  "text"     &  Text given in double quotes is to be understood as typed. \\
  \hline
  $<$text$>$ &  Text given in angled brackets is to be replaced by an
                appropriate value, if the corresponding line is used
                in \suite. It could, for example be the actual name
                of a file, or a numerical value. \\
  \hline
  {\tt text} &  Text in single quotes exclusively refers to \Suite
                commands. \\
  \hline
  $[$text$]$ &  Text in square brackets describes an optional parameter or
                command. If omitted, a default value is used, else
                the complete text given in the square brackets is to
                be typed. \\
  \hline
  \{text $|$ text\} &  Text given in curly brackets is a list of alternative
                parameters. A vertical line separates two alternative,
                mutually exclusive parameters. \\
  \hline
\end{tabularx}
\caption{\label{sym-tab}Used symbols}
\end{table}

\subsubsection{Autorun a startup macro \label{intro-auto}}

As of version 6.03.00 and later the \suite will look for a 
macro file called {\tt autorun.mac} within the starting 
folder. If this macro is found, the commands within this macro
are executed prior to any further action. 

Use this feature to customize default behavior.
At Windows the macro "autorun.mac" must be placed into the 
folder:  
\begin{MacVerbatim}
   C:\Users\your_name
\end{MacVerbatim}
Make sure to delete, move or rename this macro file if you want to 
disable the autorun feature.

For Linux and MacOS, the \Suite looks for the macro file
in the current directory at which you start the program. 
You can disable its use by moving, renaming, or deleting the
macro. Alternatively, if you use the command line option
{\tt -noautorun} a macro {\tt autorun.mac} will be ignored.
See the secion \ref{intro-cmd} for further details on command 
line options.

\subsubsection{Command line options \label{intro-cmd}}
Several command line options are available for the Linux  and
MAC version.
The most important one is to start the execution of a macro:

\begin{MacVerbatim}
discus_suite -macro useful.mac
discus_suite -macro useful_with_params.mac  par1 par2 par3
\end{MacVerbatim}

The first line would start \Suite and begin the automatic execution
of macro {\tt useful.mac}. Likewise in the second line, the macro
{\tt useful\_with\_params.mac} is started, which takes three parameters. 
The actual strings that
you provide for par1, par2, par3 are handed down as parameters to
this macro. Note that there are no comma between the parameters.

another command line option is {\tt -noautorun}. If used as in:
\begin{MacVerbatim}
discus_suite -noautorun
discus_suite -noautorun -macro useful.mac
discus_suite -noautorun -macro useful_with_params.mac  par1 par2 par3
\end{MacVerbatim}
the macro {\tt autorun.mac} is ignored, even if it is present 
within the start directory. If the command line option is 
omitted the macro {\tt autorun.mac} if performed prior to any
further action of \suite.

For info on further command line options the the on-line help for
the Command language.

\subsection{Major Updates in this last version}

In \Suite version 6.02 several of the time consuming calculations have
been moved to an automatic parallel calculation using openMP, a standard
for parallel calculations. See the section {\tt Parallel computing} in 
the general package manual 
\href{./package\_man.pdf}{DISCUS package} for further details. This internal
parallel mode should not be confused with the explicit parallel calculation as 
described in section \ref{intro-par} in this manual.
\\

In \Suite version 6.00 several new features were introduced:

A completely new refinement section \Refine allows you to run a fast
Least-Squares refinement as an alternative to the population based 
\Diffev section.  The same algorithm now works behind the scenes of the
\Kuplot {\tt fit} command.

Within \Discus the calculation of the powder PDF has been moved from 
the {\tt pdf} menu to the powder diffraction  menu. In versions 5 and 
prior, the PDF was explicitly calculated using the histogram of 
interatomic distances. As this is an approximation in the case of 
X-ray and electron diffraction, \Suite version 6 calculates the 
PDF via the powder pattern. The normalized powder pattern is 
transformed into the PDF. See \cite{neder2020} for details.

The powder menu has been thoroughly revised and improved. Besides the
new PDF output, the powder menu can now be used to calculate powder
pattern for multiple phases. 

In an analogue fashion, the 3D PDF or 3D Delta PDF is calculated 
by a Fourier transform of the (3/2)dimensional single crystal 
diffraction pattern.

To help adapt single crystal data to experimental values, a
convolution of the single crystal diffraction pattern with a
resolution function has been introduced.

The 3D output of a single crystal diffraction pattern can be stored as 
an HDF5 format file. This file is compatible with Yell.
The {\tt load} command in \Kuplot can read these files. The 
{\tt mouse} menu in \Kuplot has been augmented to allow to view these
files.

The space groups have been expanded to include all alternative 
setting for the orthorhomic space groups.

Noteworthy new features in the command language include:

On a more internal technical note, the internal accuracy of the
interpreter language has been increased. 
 
The option to use continuations of a long line across 
several lines in a macro.

Vector and matrix variables along with the usual matrix 
manipulation tools were introduced.  

The new {\tt update} command will perform an update to the latest 
version.

The Windows version of the \Suite has migrated onto the
Windows-Subsystem-Linux platform. This presents an improvement
in calculation speeds by about 30\%.

Automatic installer scripts for all operating systems should make
the installation much ore straightforward.

\section{Parallel execution \label{intro-par}}

The typical application of the \Suite is a run on a massive parallel 
system. You will have to check for details with your local administrator.
In general you should expect to start \Suite along the lines of:

\begin{MacVerbatim}
mpiexec -n 192 discus_suite -macro refine.mac > /dev/null
\end{MacVerbatim}

The command {\tt mpiexec} initiates the MPI system. Here in this example
we request 192 CPUs {\tt -n 192}. The MPI system then starts the \Suite
and read its input from the macro {\tt refine.mac}. All output is discarded
 to {\tt /dev/null} in order to minimize I/O. During development of your 
macro you might redirect the output to a logfile.

The example line above works fine on a single multi-core computer with 
Linux. The number of processes would be more reasonably placed around 
the number of CPUs on your computer.

Within the Windows version, parallel execution of such a macro is 
performed by \Suite command {\it parallel}:

\begin{MacVerbatim}
parallel refine.mac 
parallel 6, refine.mac 
\end{MacVerbatim}

The first command version instructs \Suite to run a parallel 
refinement via the macro {\it suite.mac}. The number of parallel 
threads is determined automatically. Alternatively you can tell 
\Suite how many parallel threads you would like to run by adding the
number of threads prior to the macro name. In the example above 
\Suite is instructed to use 6 threads.


%------------------------------------------------------------------------

\section{Command language}

The program includes a FORTRAN style interpreter that allows the
user to program complex modifications. A detailed discussion about the 
command language which is common to all \Discus package programs can be 
found in the separate \Discus package reference guide which is included with 
the package. At the moment, \Suite does not include any specific
variables.

